<!DOCTYPE html>
<html>
<head>
  <title>FLV è¯Šæ–­å·¥å…·</title>
  <script src="https://cdn.jsdelivr.net/npm/flv.js@1.6.2/dist/flv.min.js"></script>
</head>
<body>
  <h1>FLV è§†é¢‘ç¼–ç è¯Šæ–­</h1>
  <input type="text" id="flvUrl" placeholder="è¾“å…¥ FLV URL" style="width: 500px" value="http://192.168.1.246/live/camera_4.live.flv">
  <button onclick="testFlv()">æµ‹è¯•</button>
  <br><br>
  <video id="videoElement" controls style="width: 800px"></video>
  <br><br>
  <pre id="output" style="background: #f0f0f0; padding: 10px;"></pre>

  <script>
    function log(msg) {
      document.getElementById('output').textContent += msg + '\n';
      console.log(msg);
    }

    function testFlv() {
      const url = document.getElementById('flvUrl').value;
      const videoElement = document.getElementById('videoElement');
      document.getElementById('output').textContent = '';

      log('=== FLV è¯Šæ–­å¼€å§‹ ===');
      log('URL: ' + url);
      log('');

      if (!flvjs.isSupported()) {
        log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ flv.jsï¼ˆMSE ä¸å¯ç”¨ï¼‰');
        return;
      }

      log('âœ… æµè§ˆå™¨æ”¯æŒ flv.js');
      log('');

      const flvPlayer = flvjs.createPlayer({
        type: 'flv',
        url: url,
        isLive: true,
        hasAudio: true,
        hasVideo: true,
      }, {
        enableWorker: false,
        enableStashBuffer: true,
        stashInitialSize: 384,
        autoCleanupSourceBuffer: true,
      });

      flvPlayer.attachMediaElement(videoElement);

      // ç›‘å¬æ‰€æœ‰äº‹ä»¶
      flvPlayer.on(flvjs.Events.ERROR, (errorType, errorDetail, errorInfo) => {
        log('âŒ ERROR: ' + errorType + ', ' + errorDetail);
        log('   è¯¦æƒ…: ' + JSON.stringify(errorInfo, null, 2));
      });

      flvPlayer.on(flvjs.Events.MEDIA_INFO, (mediaInfo) => {
        log('ğŸ“Š MEDIA_INFO:');
        log('   è§†é¢‘ç¼–ç : ' + mediaInfo.videoCodec + ' (videoCodecId: ' + mediaInfo.videoCodecId + ')');
        log('   éŸ³é¢‘ç¼–ç : ' + mediaInfo.audioCodec + ' (audioCodecId: ' + mediaInfo.audioCodecId + ')');
        log('   å®½åº¦: ' + mediaInfo.width + 'x' + mediaInfo.height);
        log('   å¸§ç‡: ' + mediaInfo.framerate);
        log('   è¯¦æƒ…: ' + JSON.stringify(mediaInfo, null, 2));
        log('');

        // æ£€æŸ¥ç¼–ç å…¼å®¹æ€§
        if (mediaInfo.videoCodecId === 12) {
          log('âŒâŒâŒ æ£€æµ‹åˆ° H.265 ç¼–ç ï¼ˆvideoCodecId=12ï¼‰ï¼');
          log('    flv.js ä¸æ”¯æŒ H.265ï¼');
          log('    éœ€è¦ ZLMediaKit è½¬ç ä¸º H.264ï¼ˆvideoCodecId=7ï¼‰');
        } else if (mediaInfo.videoCodecId === 7) {
          log('âœ… æ£€æµ‹åˆ° H.264 ç¼–ç ï¼ˆvideoCodecId=7ï¼‰- å…¼å®¹ï¼');
        } else {
          log('âš ï¸ æœªçŸ¥è§†é¢‘ç¼–ç  ID: ' + mediaInfo.videoCodecId);
        }
      });

      flvPlayer.on(flvjs.Events.STATISTICS_INFO, (stats) => {
        log('ğŸ“ˆ STATISTICS: decodedFrames=' + stats.decodedFrames + ', droppedFrames=' + stats.droppedFrames + ', speed=' + stats.speed);
      });

      flvPlayer.load();
      flvPlayer.play();

      log('');
      log('ğŸ”„ å¼€å§‹åŠ è½½æµ...');
    }

    // è‡ªåŠ¨æµ‹è¯•
    window.addEventListener('load', () => {
      setTimeout(testFlv, 500);
    });
  </script>
</body>
</html>










