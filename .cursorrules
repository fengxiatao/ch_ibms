# 长辉 IBMS 智慧楼宇项目规则

## 数据库操作规则

当需要操作 MySQL 数据库时，必须使用 `mysql-ibms` MCP Server 的工具（如 `mcp_mysql-ibms_execute_sql`）。

数据库连接信息：
- 服务器：127.0.0.1
- 数据库：ch_ibms
- 用途：长辉智慧楼宇管理系统

## 项目结构

- `ruoyi-vue-pro/` - 后端 Java 项目（Spring Boot + MyBatis Plus）
- `yudao-ui-admin-vue3/` - 前端 Vue3 管理后台（旧版）
- `ibms-admin-vue3/` - 前端 Vue3 管理后台（IBMS专用）
- `parking-miniapp/` - 停车场小程序

## 开发规范

- 后端遵循 ruoyi-vue-pro 框架规范
- 前端使用 Element Plus 组件库
- 代码注释使用中文

## 前端页面布局规范

### 布局架构

系统使用 **Flexbox 布局**（参考芋道源码规范），`AppView.vue` 已设置：
- 使用 `display: flex; flex-direction: column` 布局
- 内容区域使用 `flex: 1` 自动填充剩余空间
- 版权栏使用 `flex-shrink: 0` 固定在底部
- 外层 `ElScrollbar` 处理整体滚动

### 普通页面布局

大多数页面**不需要设置高度**，让内容自然流动：

```vue
<template>
  <ContentWrap>
    <!-- 内容自然流动，不设置固定高度 -->
    ...
  </ContentWrap>
</template>
```

### 特殊全屏页面（如首页大屏）

需要使用负边距填满整个区域的页面（如大屏、地图等），使用：

```vue
<template>
  <div class="ibms-fullpage">
    ...
  </div>
</template>
```

或在 SCSS 中：
```scss
.my-fullpage {
  height: var(--page-content-height);
  margin: -20px -20px 0 -20px;
  overflow: hidden;
}
```

### 布局变量说明

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `--top-tool-height` | 56px | 顶部工具栏高度 |
| `--tags-view-height` | 38px | 标签页高度 |
| `--app-footer-height` | 36px | 底部版权栏高度 |
| `--page-content-height` | 自动计算 | 内容区可用高度（仅用于全屏页面） |
| `--app-content-padding` | 20px | 内容区内边距 |

### 通用样式类

在 `ibms-theme.scss` 中定义了以下通用样式类：

- `.ibms-fullpage` - 全屏页面容器，使用负边距填满内容区
- `.ibms-fullpage--scroll` - 带滚动条的全屏页面
- `.ibms-fullpage--padded` - 带内边距的全屏页面
- `.ibms-page` - 普通页面容器
- `.ibms-page--fixed` - 固定高度的页面

### 固定头部/底部的列表页面

对于需要固定搜索栏和分页的列表页面，使用以下结构：

```vue
<template>
  <div class="xxx-page">
    <!-- 搜索栏：固定在顶部 -->
    <ContentWrap class="xxx-page__header">
      <el-form>...</el-form>
    </ContentWrap>

    <!-- 内容区域：可滚动 -->
    <ContentWrap class="xxx-page__content">
      <el-table>...</el-table>
      <!-- 或卡片列表 -->
    </ContentWrap>

    <!-- 分页：固定在底部 -->
    <ContentWrap class="xxx-page__footer">
      <Pagination ... />
    </ContentWrap>
  </div>
</template>

<style lang="scss" scoped>
.xxx-page {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.xxx-page__header {
  flex-shrink: 0;
}

.xxx-page__content {
  flex: 1;
  min-height: 0;
  overflow: auto;
  margin-bottom: 0 !important;
}

.xxx-page__footer {
  flex-shrink: 0;
  margin-bottom: 0 !important;
}
</style>
```

### 注意事项

1. **普通页面不要设置固定高度**：让内容自然流动，AppView 会处理布局
2. **禁止使用硬编码高度**：如 `calc(100vh - 84px)` 等
3. **全屏页面负边距**：使用 `margin: -20px -20px 0 -20px`，底部不使用负边距
4. **overflow 控制**：AppView 已处理滚动，页面内部按需设置
5. **固定头部/底部页面**：使用 flexbox 布局，内容区使用 `flex: 1; min-height: 0; overflow: auto`
