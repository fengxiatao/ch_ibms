# åŒæ•°æ®æºé…ç½®è¯´æ˜

## ğŸ“Š æ•°æ®åº“æ¶æ„

æœ¬ç³»ç»Ÿä½¿ç”¨**åŒæ•°æ®æºæ¶æ„**ï¼Œåˆ†åˆ«å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨ç³»ç»Ÿ (yudao-server)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚  MySQL   â”‚     â”‚PostgreSQLâ”‚
    â”‚ ch_ibms  â”‚     â”‚ibms_gis  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ MySQL æ•°æ®åº“ï¼š`ch_ibms`

### ç”¨é€”
å­˜å‚¨**ä¸šåŠ¡æ•°æ®**å’Œ**IoTç‰©è”ç½‘æ•°æ®**

### åŒ…å«çš„è¡¨

#### 1. ç³»ç»ŸåŸºç¡€è¡¨ï¼ˆsystem_*ï¼‰
- `system_menu` - èœå•æƒé™
- `system_role` - è§’è‰²
- `system_user` - ç”¨æˆ·
- `system_dept` - éƒ¨é—¨
- ç­‰ç­‰...

#### 2. IoTç‰©è”ç½‘æ¨¡å—ï¼ˆiot_*ï¼‰
| è¡¨å | è¯´æ˜ | å¯¼å…¥è„šæœ¬ |
|------|------|---------|
| `iot_product` | äº§å“è¡¨ | `iot_module.sql` |
| `iot_product_category` | äº§å“åˆ†ç±»è¡¨ | `iot_module.sql` |
| `iot_device` | è®¾å¤‡è¡¨ | `iot_module.sql` |
| **`iot_job_type_definition`** | **ä»»åŠ¡ç±»å‹å®šä¹‰è¡¨** â­ | `iot_job_type_definition.sql` |

#### 3. åŸºç¡€è®¾æ–½æ¨¡å—ï¼ˆinfra_*ï¼‰
- `infra_api_access_log` - APIè®¿é—®æ—¥å¿—
- `infra_api_error_log` - APIé”™è¯¯æ—¥å¿—
- ç­‰ç­‰...

### é…ç½®ä½ç½®
```yaml
# application-dev.yaml
spring:
  datasource:
    dynamic:
      primary: master
      datasource:
        master:  # ä¸»æ•°æ®æº - MySQL
          url: jdbc:mysql://127.0.0.1:3306/ch_ibms?...
          username: root
          password: ${MYSQL_PASSWORD:123456}
```

### å¯¼å…¥è„šæœ¬
```bash
cd F:\work\ch_ibms\ruoyi-vue-pro\sql\mysql

# æ–¹å¼1ï¼šä¸€é”®å¯¼å…¥æ‰€æœ‰è¡¨
ä¸€é”®å¯¼å…¥æ‰€æœ‰è¡¨ç»“æ„.bat

# æ–¹å¼2ï¼šåˆ†åˆ«å¯¼å…¥
mysql -u root -p ch_ibms < iot_module.sql
mysql -u root -p ch_ibms < iot_job_type_definition.sql
```

---

## ğŸ—„ï¸ PostgreSQL æ•°æ®åº“ï¼š`ibms_gis`

### ç”¨é€”
å­˜å‚¨**ç©ºé—´è®¾æ–½æ•°æ®**ï¼ˆGISåœ°ç†ä¿¡æ¯ï¼‰

### åŒ…å«çš„è¡¨

| è¡¨å | è¯´æ˜ | å±‚çº§ | å¯¼å…¥è„šæœ¬ |
|------|------|------|---------|
| `ibms_gis_campus` | å›­åŒºè¡¨ | L1 | `gis_spatial_module.sql` |
| `ibms_gis_building` | å»ºç­‘è¡¨ | L2 | `gis_spatial_module.sql` |
| `ibms_gis_floor` | æ¥¼å±‚è¡¨ | L3 | `gis_spatial_module.sql` |
| `ibms_gis_area` | åŒºåŸŸè¡¨ | L4 | `gis_spatial_module.sql` |

### ç©ºé—´å±‚çº§å…³ç³»
```
å›­åŒº (Campus)
  â””â”€ å»ºç­‘ (Building)
      â””â”€ æ¥¼å±‚ (Floor)
          â””â”€ åŒºåŸŸ (Area)
```

### é…ç½®ä½ç½®
```yaml
# application-dev.yaml
spring:
  datasource:
    dynamic:
      datasource:
        gis:  # GISæ•°æ®æº - PostgreSQL
          url: jdbc:postgresql://127.0.0.1:5432/ibms_gis
          username: postgres
          password: ${POSTGRES_PASSWORD:postgres}
          driver-class-name: org.postgresql.Driver
```

### å¯¼å…¥è„šæœ¬
```bash
# ä½¿ç”¨psqlå‘½ä»¤
psql -U postgres -d ibms_gis -f gis_spatial_module.sql

# æˆ–ä½¿ç”¨pgAdminç­‰å·¥å…·æ‰§è¡ŒSQL
```

---

## ğŸ”„ æ•°æ®æºè·¯ç”±è§„åˆ™

### ä»£ç ä¸­çš„æ•°æ®æºæŒ‡å®š

```java
// MySQLæ•°æ®æºï¼ˆé»˜è®¤ï¼‰
@Mapper
public interface IotProductMapper extends BaseMapperX<IotProductDO> {
    // è‡ªåŠ¨ä½¿ç”¨masteræ•°æ®æºï¼ˆMySQLï¼‰
}

// PostgreSQLæ•°æ®æº
@DS("gis")  // æ˜¾å¼æŒ‡å®šä½¿ç”¨gisæ•°æ®æº
@Mapper
public interface CampusMapper extends BaseMapperX<CampusDO> {
    // ä½¿ç”¨gisæ•°æ®æºï¼ˆPostgreSQLï¼‰
}
```

### å„æ¨¡å—ä½¿ç”¨çš„æ•°æ®æº

| æ¨¡å— | æ•°æ®æº | æ•°æ®åº“ | ç¤ºä¾‹è¡¨ |
|------|--------|--------|--------|
| ç³»ç»Ÿç®¡ç† | master (MySQL) | ch_ibms | system_menu |
| IoTç‰©è”ç½‘ | master (MySQL) | ch_ibms | iot_product, iot_device |
| ä»»åŠ¡é…ç½® | master (MySQL) | ch_ibms | iot_job_type_definition |
| ç©ºé—´è®¾æ–½ | gis (PostgreSQL) | ibms_gis | ibms_gis_campus |

---

## ğŸ“ æ¥å£æŸ¥è¯¢è¯´æ˜

### æ‚¨æåˆ°çš„æ¥å£

```java
@GetMapping("/applicable")
@Operation(summary = "è·å–é€‚ç”¨äºæŒ‡å®šå®ä½“ç±»å‹çš„ä»»åŠ¡ç±»å‹åˆ—è¡¨")
public CommonResult<List<JobTypeDefinitionDO>> getApplicableJobTypes(
    @RequestParam("entityType") String entityType) {
    List<JobTypeDefinitionDO> list = jobTypeDefinitionService.getApplicableJobTypes(entityType);
    return success(list);
}
```

**æŸ¥è¯¢çš„è¡¨ï¼š** `iot_job_type_definition` ï¼ˆåœ¨MySQLçš„`ch_ibms`æ•°æ®åº“ä¸­ï¼‰

**æŸ¥è¯¢é€»è¾‘ï¼š**
```java
// JobTypeDefinitionMapper.java
default List<JobTypeDefinitionDO> selectApplicableJobTypes(String entityType) {
    return selectList(new LambdaQueryWrapper<JobTypeDefinitionDO>()
        .apply("FIND_IN_SET({0}, applicable_entities) > 0", entityType)
        .eq(JobTypeDefinitionDO::getStatus, 1)
        .orderByAsc(JobTypeDefinitionDO::getId));
}
```

**ç¤ºä¾‹è¯·æ±‚ï¼š**
```bash
# è·å–é€‚ç”¨äºäº§å“çš„ä»»åŠ¡ç±»å‹
GET /admin-api/iot/task-config/applicable?entityType=PRODUCT

# è¿”å›ç»“æœåŒ…å«ï¼š
# - è®¾å¤‡ç¦»çº¿æ£€æŸ¥
# - è®¾å¤‡å¥åº·æ£€æŸ¥
# - è®¾å¤‡æ•°æ®é‡‡é›†
# - æ‘„åƒå¤´å·¡æ£€
# ç­‰ç­‰...
```

---

## âœ… å®Œæ•´å¯¼å…¥æ­¥éª¤

### Step 1: å¯¼å…¥MySQLè¡¨ï¼ˆä¸šåŠ¡è¡¨ + IoTè¡¨ï¼‰

```bash
cd F:\work\ch_ibms\ruoyi-vue-pro\sql\mysql

# ä½¿ç”¨ä¸€é”®è„šæœ¬
ä¸€é”®å¯¼å…¥æ‰€æœ‰è¡¨ç»“æ„.bat

# æˆ–æ‰‹åŠ¨å¯¼å…¥
mysql -u root -p ch_ibms < iot_module.sql
mysql -u root -p ch_ibms < iot_job_type_definition.sql
```

### Step 2: å¯¼å…¥PostgreSQLè¡¨ï¼ˆç©ºé—´è¡¨ï¼‰

**æ³¨æ„ï¼š** GISç©ºé—´è¡¨éœ€è¦å•ç‹¬å¯¼å…¥åˆ°PostgreSQLæ•°æ®åº“ï¼

```bash
# æ–¹å¼1ï¼šä½¿ç”¨psql
psql -U postgres -d ibms_gis -f gis_spatial_module.sql

# æ–¹å¼2ï¼šä½¿ç”¨pgAdmin
# 1. è¿æ¥åˆ°PostgreSQLæœåŠ¡å™¨
# 2. é€‰æ‹©ibms_gisæ•°æ®åº“
# 3. æ‰“å¼€Query Tool
# 4. åŠ è½½å¹¶æ‰§è¡Œ gis_spatial_module.sql
```

### Step 3: éªŒè¯å¯¼å…¥

```sql
-- åœ¨MySQLä¸­éªŒè¯
USE ch_ibms;
SHOW TABLES LIKE 'iot_%';
SELECT COUNT(*) FROM iot_job_type_definition;  -- åº”è¯¥æœ‰20æ¡è®°å½•

-- åœ¨PostgreSQLä¸­éªŒè¯
\c ibms_gis
SELECT tablename FROM pg_tables WHERE tablename LIKE 'ibms_gis_%';
SELECT COUNT(*) FROM ibms_gis_campus;
```

### Step 4: é‡å¯åç«¯æœåŠ¡

é‡å¯åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿æ¥ä¸¤ä¸ªæ•°æ®æºã€‚

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ç”¨åŒæ•°æ®æºï¼Ÿ

**A:** 
1. **PostgreSQL** æ“…é•¿å¤„ç†åœ°ç†ç©ºé—´æ•°æ®ï¼ˆGISï¼‰
2. **MySQL** é€‚åˆä¸šåŠ¡æ•°æ®å’ŒIoTè®¾å¤‡æ•°æ®
3. åˆ†ç¦»å­˜å‚¨ï¼Œæé«˜æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§

### Q2: å¦‚æœåªæƒ³ç”¨MySQLæ€ä¹ˆåŠï¼Ÿ

**A:** å¯ä»¥å°†GISè¡¨ä¹Ÿåˆ›å»ºåœ¨MySQLä¸­ï¼Œä½†éœ€è¦ï¼š
1. ä¿®æ”¹GISç›¸å…³çš„Mapperï¼Œå»æ‰`@DS("gis")`æ³¨è§£
2. åœ¨MySQLä¸­æ‰§è¡Œ`gis_spatial_module.sql`
3. è°ƒæ•´SQLè¯­æ³•ï¼ˆPostgreSQLä¸MySQLæœ‰äº›å·®å¼‚ï¼‰

### Q3: ä»»åŠ¡ç±»å‹å®šä¹‰è¡¨åœ¨å“ªä¸ªæ•°æ®åº“ï¼Ÿ

**A:** åœ¨**MySQL**çš„`ch_ibms`æ•°æ®åº“ä¸­ï¼Œå› ä¸ºå®ƒå±äºIoTæ¨¡å—çš„é…ç½®è¡¨ã€‚

### Q4: ç©ºé—´è®¾æ–½çš„å®šæ—¶ä»»åŠ¡é…ç½®å­˜åœ¨å“ªé‡Œï¼Ÿ

**A:** 
- **ä»»åŠ¡ç±»å‹å®šä¹‰**ï¼šåœ¨MySQLçš„`iot_job_type_definition`è¡¨
- **å…·ä½“çš„ä»»åŠ¡é…ç½®**ï¼šåœ¨PostgreSQLçš„ç©ºé—´è¡¨ï¼ˆcampus/building/floor/areaï¼‰çš„`job_config`å­—æ®µ

---

## ğŸ“‹ è¡¨ç»“æ„æ¸…å•

### MySQL (ch_ibms) - 4å¼ IoTè¡¨

| åºå· | è¡¨å | è¡Œæ•° | å¤§å° | é‡è¦æ€§ |
|------|------|------|------|--------|
| 1 | iot_product | ~10 | å° | â­â­â­ |
| 2 | iot_product_category | ~5 | å° | â­â­ |
| 3 | iot_device | ~100 | ä¸­ | â­â­â­ |
| 4 | iot_job_type_definition | 20 | å° | â­â­â­â­â­ |

### PostgreSQL (ibms_gis) - 4å¼ ç©ºé—´è¡¨

| åºå· | è¡¨å | è¡Œæ•° | å¤§å° | é‡è¦æ€§ |
|------|------|------|------|--------|
| 1 | ibms_gis_campus | ~5 | å° | â­â­â­â­ |
| 2 | ibms_gis_building | ~20 | å° | â­â­â­â­ |
| 3 | ibms_gis_floor | ~100 | ä¸­ | â­â­â­ |
| 4 | ibms_gis_area | ~500 | å¤§ | â­â­â­ |

---

## ğŸ¯ æ€»ç»“

1. **ä¸šåŠ¡å’ŒIoTæ•°æ®** â†’ MySQL (`ch_ibms`)
2. **ç©ºé—´è®¾æ–½æ•°æ®** â†’ PostgreSQL (`ibms_gis`)
3. **ä»»åŠ¡ç±»å‹å®šä¹‰** â†’ MySQL (`ch_ibms`) çš„ `iot_job_type_definition` è¡¨
4. **æ¥å£æŸ¥è¯¢** â†’ æŸ¥è¯¢MySQLä¸­çš„ä»»åŠ¡ç±»å‹å®šä¹‰ï¼Œé€‚ç”¨äºæ‰€æœ‰å®ä½“ç±»å‹

**å…³é”®ç‚¹ï¼š** æ‚¨æåˆ°çš„æ¥å£ç¡®å®éœ€è¦æŸ¥è¯¢è¡¨ç»“æ„ï¼ŒæŸ¥è¯¢çš„æ˜¯MySQLä¸­çš„ `iot_job_type_definition` è¡¨ï¼

