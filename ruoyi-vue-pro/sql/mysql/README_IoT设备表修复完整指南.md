# IoT è®¾å¤‡è¡¨ä¿®å¤ - å®Œæ•´æŒ‡å—

## ğŸ¯ é—®é¢˜æ±‡æ€»

åœ¨æ¿€æ´»IoTè®¾å¤‡æ—¶é‡åˆ°ä»¥ä¸‹ä¸¤ä¸ªæ•°æ®åº“é”™è¯¯ï¼š

### é—®é¢˜1: device_key å­—æ®µç¼ºå¤±

```
Field 'device_key' doesn't have a default value
```

### é—®é¢˜2: Boolean å­—æ®µç±»å‹ä¸åŒ¹é…

```
Data truncation: Data too long for column 'subsystem_override' at row 1
```

---

## âœ… ä¸€é”®ä¿®å¤ï¼ˆæ¨èï¼‰

### ğŸš€ ä½¿ç”¨ç»¼åˆä¿®å¤å·¥å…·

```bash
cd F:\work\ch_ibms\ruoyi-vue-pro\sql\mysql
ä¸€é”®ä¿®å¤IoTè®¾å¤‡è¡¨.bat
```

**è¿™ä¸ªæ‰¹å¤„ç†æ–‡ä»¶ä¼šè‡ªåŠ¨**ï¼š
1. âœ… æ·»åŠ  `device_key` å­—æ®µ
2. âœ… ä¸ºå·²æœ‰è®¾å¤‡ç”Ÿæˆ `device_key`
3. âœ… æ·»åŠ å”¯ä¸€ç´¢å¼• `uk_device_key`
4. âœ… ä¿®å¤ `subsystem_override` å­—æ®µç±»å‹ (VARCHAR â†’ BIT)
5. âœ… ä¿®å¤ `menu_override` å­—æ®µç±»å‹ (VARCHAR â†’ BIT)

---

## ğŸ“‹ åˆ†æ­¥ä¿®å¤ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å•ç‹¬æ‰§è¡Œï¼Œå¯ä»¥åˆ†æ­¥è¿›è¡Œï¼š

### æ­¥éª¤1: ä¿®å¤ device_key å­—æ®µ

```bash
cd F:\work\ch_ibms\ruoyi-vue-pro\sql\mysql
æ·»åŠ device_keyå­—æ®µ.bat
```

æˆ–æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
mysql -h127.0.0.1 -P3306 -uroot -p123456 -Druoyi-vue-pro < iot_device_add_device_key.sql
```

### æ­¥éª¤2: ä¿®å¤ Boolean å­—æ®µ

```bash
mysql -h127.0.0.1 -P3306 -uroot -p123456 -Druoyi-vue-pro < iot_device_fix_boolean_fields.sql
```

---

## ğŸ” é—®é¢˜è¯¦è§£

### device_key å­—æ®µ

#### é—®é¢˜åŸå› 
- âŒ æ•°æ®åº“è¡¨ç¼ºå°‘ `device_key` å­—æ®µ
- âŒ DO ç±» `IotDeviceDO` æœªå®šä¹‰è¯¥å­—æ®µ
- âŒ ä»£ç æœªç”Ÿæˆ `device_key` å€¼

#### ä¿®å¤å†…å®¹
- âœ… æ·»åŠ  `device_key VARCHAR(255)` å­—æ®µ
- âœ… ä¸ºå·²æœ‰è®¾å¤‡ç”Ÿæˆ `device_key`ï¼ˆæ ¼å¼ï¼š`{productKey}_{serialNumber}`ï¼‰
- âœ… æ·»åŠ å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤

#### ä»£ç å·²ä¿®å¤
- âœ… `IotDeviceDO.java` - æ·»åŠ å­—æ®µå®šä¹‰
- âœ… `IotDeviceActivationServiceImpl.java` - å®ç°è‡ªåŠ¨ç”Ÿæˆé€»è¾‘

---

### Boolean å­—æ®µç±»å‹

#### é—®é¢˜åŸå› 
- âŒ Java ä¸­å®šä¹‰ä¸º `Boolean` ç±»å‹
- âŒ æ•°æ®åº“ä¸­é”™è¯¯åœ°å®šä¹‰ä¸º `VARCHAR` ç±»å‹
- âŒ MyBatis-Plus ç±»å‹è½¬æ¢å¤±è´¥

#### ä¿®å¤å†…å®¹
- âœ… ä¿®æ”¹ `subsystem_override` ä¸º `BIT(1)` ç±»å‹
- âœ… ä¿®æ”¹ `menu_override` ä¸º `BIT(1)` ç±»å‹
- âœ… è®¾ç½®é»˜è®¤å€¼ä¸º `b'0'` (false)

#### ç±»å‹å¯¹ç…§

| Java ç±»å‹ | æ•°æ®åº“ç±»å‹ï¼ˆä¿®å¤å‰ï¼‰| æ•°æ®åº“ç±»å‹ï¼ˆä¿®å¤åï¼‰|
|-----------|-------------------|-------------------|
| `Boolean` | âŒ `VARCHAR(255)` | âœ… `BIT(1)` |

---

## ğŸ“Š ä¿®å¤åçš„è¡¨ç»“æ„

### å…³é”®å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|---------|--------|------|
| `device_key` | `VARCHAR(255)` | `NULL` | è®¾å¤‡å”¯ä¸€æ ‡è¯† |
| `subsystem_override` | `BIT(1)` | `b'0'` | æ˜¯å¦è¦†ç›–å­ç³»ç»Ÿ |
| `menu_override` | `BIT(1)` | `b'0'` | æ˜¯å¦è¦†ç›–èœå• |

### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|--------|------|------|------|
| `uk_device_key` | UNIQUE | `device_key`, `deleted` | è®¾å¤‡å”¯ä¸€æ ‡è¯†çº¦æŸ |

---

## âœ… éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥å­—æ®µæ˜¯å¦æ·»åŠ 

```sql
DESC iot_device;
```

**åº”è¯¥çœ‹åˆ°**ï¼š
- âœ… `device_key VARCHAR(255)` å­—æ®µå­˜åœ¨
- âœ… `subsystem_override BIT(1)` ç±»å‹æ­£ç¡®
- âœ… `menu_override BIT(1)` ç±»å‹æ­£ç¡®

### 2. æ£€æŸ¥å·²æœ‰è®¾å¤‡çš„ device_key

```sql
SELECT 
    id, 
    device_name, 
    product_key, 
    device_key,
    subsystem_override,
    menu_override,
    state
FROM iot_device
ORDER BY id DESC
LIMIT 5;
```

**åº”è¯¥çœ‹åˆ°**ï¼š
- âœ… å·²æœ‰è®¾å¤‡éƒ½æœ‰ `device_key` å€¼
- âœ… Boolean å­—æ®µæ˜¾ç¤ºä¸º `0` æˆ– `1`

### 3. æµ‹è¯•è®¾å¤‡æ¿€æ´»

1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd F:\work\ch_ibms\ruoyi-vue-pro
å¯åŠ¨åç«¯æœåŠ¡.bat
```

2. æ‰“å¼€å‰ç«¯è®¾å¤‡å‘ç°é¡µé¢
3. æ‰«æå¹¶æ¿€æ´»ä¸€ä¸ªæ–°è®¾å¤‡
4. åº”è¯¥æˆåŠŸï¼Œä¸å†æŠ¥é”™

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### device_key ç”Ÿæˆè§„åˆ™

```java
// æœ‰åºåˆ—å·
device_key = productKey + "_" + serialNumber
ä¾‹å¦‚: iot_camera_æªæœº_v1_001_20250108001

// æ— åºåˆ—å·
device_key = productKey + "_" + UUID
ä¾‹å¦‚: iot_camera_æªæœº_v1_001_a1b2c3d4e5f6
```

### Boolean å­—æ®µæ ‡å‡†

**èŠ‹é“æºç æ¡†æ¶æ ‡å‡†**ï¼š
```sql
subsystem_override bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦è¦†ç›–'
```

**å­˜å‚¨è§„åˆ™**ï¼š
- `0` = `false` (ç»§æ‰¿äº§å“é…ç½®)
- `1` = `true` (æ‰‹åŠ¨è¦†ç›–)

---

## ğŸ“¦ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶å | ç”¨é€” |
|--------|------|
| `iot_device_add_device_key.sql` | æ·»åŠ  device_key å­—æ®µ |
| `iot_device_fix_boolean_fields.sql` | ä¿®å¤ Boolean å­—æ®µç±»å‹ |
| `ä¸€é”®ä¿®å¤IoTè®¾å¤‡è¡¨.bat` | **ç»¼åˆä¿®å¤å·¥å…·ï¼ˆæ¨èä½¿ç”¨ï¼‰** |
| `æ·»åŠ device_keyå­—æ®µ.bat` | å•ç‹¬ä¿®å¤ device_key |
| `README_IoTè®¾å¤‡è¡¨ä¿®å¤å®Œæ•´æŒ‡å—.md` | æœ¬æ–‡æ¡£ |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [device_key ä¿®å¤è¯¦ç»†è¯´æ˜](../../docs/errors/åç«¯_è®¾å¤‡æ¿€æ´»å¤±è´¥_device_keyå­—æ®µç¼ºå¤±.md)
- [Boolean å­—æ®µè¯¦ç»†è¯´æ˜](../../docs/errors/åç«¯_è®¾å¤‡æ¿€æ´»å¤±è´¥_Booleanå­—æ®µç±»å‹ä¸åŒ¹é….md)
- [é”™è¯¯çŸ¥è¯†åº“ç´¢å¼•](../../docs/errors/INDEX.md)

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ç”¨ BIT(1) è€Œä¸æ˜¯ TINYINT(1)ï¼Ÿ

**ç­”**: èŠ‹é“æºç æ¡†æ¶ç»Ÿä¸€ä½¿ç”¨ `BIT(1)`ï¼š
- âœ… å­˜å‚¨ç©ºé—´æ›´å°ï¼ˆ1 bit vs 8 bitsï¼‰
- âœ… è¯­ä¹‰æ›´æ¸…æ™°ï¼ˆä½æ ‡å¿—ï¼‰
- âœ… ä¸æ¡†æ¶æ ‡å‡†ä¸€è‡´ï¼ˆå¦‚ `deleted` å­—æ®µï¼‰

### Q2: ä¿®å¤åå·²æœ‰æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ

**ç­”**: âŒ ä¸ä¼šï¼
- âœ… `device_key` ä¼šè‡ªåŠ¨ä¸ºå·²æœ‰è®¾å¤‡ç”Ÿæˆ
- âœ… Boolean å­—æ®µä¼šä¿ç•™åŸæœ‰å€¼
- âœ… æ‰€æœ‰æ•°æ®å®Œæ•´æ€§ä¿æŒ

### Q3: éœ€è¦ä¿®æ”¹ä»£ç å—ï¼Ÿ

**ç­”**: âœ… ä»£ç å·²è‡ªåŠ¨ä¿®å¤
- âœ… `IotDeviceDO` å·²æ·»åŠ  `deviceKey` å­—æ®µ
- âœ… `IotDeviceActivationServiceImpl` å·²å®ç°ç”Ÿæˆé€»è¾‘
- âœ… åªéœ€æ‰§è¡Œæ•°æ®åº“è„šæœ¬ï¼Œç„¶åé‡å¯æœåŠ¡

---

## ğŸ‰ ä¿®å¤å®Œæˆ

æ‰§è¡Œå®Œæ•°æ®åº“ä¿®å¤åï¼š

1. âœ… é‡å¯åç«¯æœåŠ¡
2. âœ… æµ‹è¯•è®¾å¤‡æ¿€æ´»åŠŸèƒ½
3. âœ… ç¡®è®¤ä¸å†æŠ¥é”™

**çŠ¶æ€**: âœ… é—®é¢˜å·²å®Œå…¨è§£å†³  
**æœ€åæ›´æ–°**: 2025-10-27














