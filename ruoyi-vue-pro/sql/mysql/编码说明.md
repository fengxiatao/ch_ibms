# 部署脚本编码说明

## 📝 重要提示

在处理包含中文的批处理文件和SQL文件时，**编码问题**至关重要！

## 🔧 文件编码要求

### 1. 批处理文件 (.bat)

**推荐编码**: UTF-8 with BOM

**原因**:
- Windows命令提示符默认使用GBK编码
- 使用UTF-8 with BOM可以让Windows正确识别文件编码
- 脚本中的`chcp 65001`命令会将控制台切换到UTF-8模式

**如何设置**:
```
在VS Code中：
1. 打开.bat文件
2. 点击右下角的编码显示（如"UTF-8"）
3. 选择"通过编码保存"
4. 选择"UTF-8 with BOM"
```

### 2. PowerShell脚本 (.ps1)

**推荐编码**: UTF-8 (无BOM)

**原因**:
- PowerShell默认支持UTF-8
- 脚本中已设置输出编码为UTF-8
- 无需BOM标记

### 3. SQL文件 (.sql)

**推荐编码**: UTF-8 (无BOM)

**原因**:
- MySQL默认支持UTF-8
- 脚本中使用`--default-character-set=utf8mb4`参数
- 避免BOM导致的解析问题

## 📋 部署脚本对比

### 方式1: 批处理脚本 (推荐Windows用户)

```batch
# 文件: deploy_video_patrol.bat
# 编码: UTF-8 with BOM
# 运行: 双击运行或在cmd中执行

deploy_video_patrol.bat
```

**优点**:
- ✅ 双击即可运行
- ✅ 兼容性好
- ✅ 无需额外配置

**缺点**:
- ⚠️ 编码要求严格
- ⚠️ 错误处理相对简单

### 方式2: PowerShell脚本 (推荐高级用户)

```powershell
# 文件: deploy_video_patrol.ps1
# 编码: UTF-8 (无BOM)
# 运行: 右键"使用PowerShell运行"或在PowerShell中执行

.\deploy_video_patrol.ps1
```

**优点**:
- ✅ 编码处理更好
- ✅ 错误提示更详细
- ✅ 支持彩色输出
- ✅ 密码输入更安全

**缺点**:
- ⚠️ 可能需要设置执行策略
- ⚠️ 需要PowerShell 5.0+

**首次运行PowerShell脚本需要设置执行策略**:
```powershell
# 以管理员身份运行PowerShell，执行：
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## 🔍 编码问题排查

### 问题1: 批处理文件中文乱码

**症状**: 运行.bat文件时，中文显示为乱码

**解决方案**:
1. 确认文件编码为UTF-8 with BOM
2. 确认脚本开头有`chcp 65001`命令
3. 使用VS Code或Notepad++重新保存文件

### 问题2: SQL执行时中文乱码

**症状**: 数据库中的中文菜单名称显示为乱码

**解决方案**:
1. 确认SQL文件编码为UTF-8
2. 确认MySQL命令使用了`--default-character-set=utf8mb4`参数
3. 检查数据库字符集设置：
```sql
SHOW VARIABLES LIKE 'character_set%';
```

### 问题3: PowerShell脚本输出乱码

**症状**: PowerShell中中文显示不正常

**解决方案**:
1. 确认脚本开头设置了输出编码
2. 确认PowerShell控制台字体支持中文（如"新宋体"）
3. 在PowerShell配置文件中添加：
```powershell
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
```

## 📊 编码对照表

| 文件类型 | 推荐编码 | BOM | 说明 |
|---------|---------|-----|------|
| .bat | UTF-8 | ✅ 需要 | Windows批处理需要BOM识别 |
| .ps1 | UTF-8 | ❌ 不需要 | PowerShell原生支持UTF-8 |
| .sql | UTF-8 | ❌ 不需要 | MySQL推荐无BOM |
| .md | UTF-8 | ❌ 不需要 | Markdown标准编码 |
| .vue | UTF-8 | ❌ 不需要 | 前端文件标准编码 |
| .java | UTF-8 | ❌ 不需要 | Java源码标准编码 |

## 🛠️ 编辑器配置

### VS Code

在`.vscode/settings.json`中添加：

```json
{
  "files.encoding": "utf8",
  "files.autoGuessEncoding": true,
  "[bat]": {
    "files.encoding": "utf8bom"
  },
  "[powershell]": {
    "files.encoding": "utf8"
  }
}
```

### IntelliJ IDEA

1. File → Settings → Editor → File Encodings
2. 设置Global Encoding为UTF-8
3. 设置Project Encoding为UTF-8
4. 勾选"Transparent native-to-ascii conversion"

## ✅ 最佳实践

1. **统一使用UTF-8编码**
   - 所有文本文件统一使用UTF-8
   - 避免使用GBK、GB2312等编码

2. **注意BOM标记**
   - Windows批处理文件需要BOM
   - 其他文件尽量不使用BOM

3. **版本控制配置**
   - 在`.gitattributes`中配置：
   ```
   *.bat text eol=crlf
   *.ps1 text eol=crlf
   *.sql text eol=lf
   ```

4. **团队协作**
   - 在项目文档中明确编码规范
   - 使用EditorConfig统一编辑器配置
   - Code Review时检查编码问题

## 📚 相关资源

- [UTF-8编码详解](https://zh.wikipedia.org/wiki/UTF-8)
- [Windows代码页](https://docs.microsoft.com/zh-cn/windows/win32/intl/code-pages)
- [MySQL字符集](https://dev.mysql.com/doc/refman/8.0/en/charset.html)

---

**更新日期**: 2025-11-16  
**版本**: v1.0.0
