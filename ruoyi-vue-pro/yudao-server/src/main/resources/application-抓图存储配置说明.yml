# =====================================================
# IoT 摄像头抓图存储配置
# =====================================================
# 
# ⚠️ 注意：这是临时配置方案！
# 
# 【当前实现】：yml硬编码配置（临时方案，快速验证功能）
# 【正确实现】：应使用基础设施模块的FileService
# 
# 正确的架构方式：
# 1. 在管理后台"基础设施 → 文件管理 → 文件配置"中配置
# 2. 配置信息存储在 infra_file_config 表
# 3. 代码中注入 FileService
# 4. 使用 fileService.createFile() 上传文件
# 5. 文件记录自动保存到 infra_file 表
# 
# 当前使用yml配置的原因：
# - Gateway层抓拍功能还未完全实现
# - 先快速验证业务流程
# - 后续优化时再统一切换到FileService
# 
# 详细说明请参考：
# - 正确的文件存储集成方案.md
# - 文件存储实施说明-当前阶段.md
# - FileService集成-快速参考.md
# 
# =====================================================
# 
# 本配置关联基础设施模块的文件存储功能
# 抓图文件通过ZLMediaKit或ONVIF保存，路径规则由本配置定义
#
# =====================================================

iot:
  snapshot:
    # 抓图文件存储目录（相对路径或绝对路径）
    # 
    # 规则：
    # - 相对路径：相对于应用的工作目录
    # - 绝对路径：直接使用指定的完整路径
    # 
    # 示例：
    # - /snapshots                          → Linux绝对路径
    # - D:/snapshots                        → Windows绝对路径
    # - snapshots                           → 相对路径
    # 
    # 默认值：/snapshots
    directory: /snapshots
    
    # 抓图文件URL前缀（HTTP访问地址）
    # 
    # 用途：
    # - 前端通过此URL访问抓图文件
    # - 配合HTTP服务器地址
    # 
    # 格式：http://{服务器IP}:{HTTP端口}/snapshots
    # 
    # 示例：
    # - http://192.168.1.246:8080/snapshots
    # - http://localhost:8080/snapshots
    # 
    # 注意：
    # - 可以是后端服务器（Spring Boot）
    # - 也可以是ZLMediaKit的HTTP服务器
    # - 也可以是Nginx等静态文件服务器
    url-prefix: http://192.168.1.246:8080/snapshots
    
    # 抓图文件命名规则（自动生成）
    # 格式：/snapshots/{deviceId}/{yyyyMMdd}/snapshot_{timestamp}_{deviceId}.jpg
    # 
    # 示例：
    # /snapshots/8/20251031/snapshot_1730390400000_8.jpg
    # 
    # 说明：
    # - {deviceId}: 设备ID
    # - {yyyyMMdd}: 日期（年月日）
    # - {timestamp}: 时间戳（毫秒）
    # 
    # 优点：
    # - 按设备分目录，便于管理
    # - 按日期分目录，便于归档和清理
    # - 文件名包含设备ID和时间戳，确保唯一性

# =====================================================
# 抓图方式说明
# =====================================================
# 
# 方式1：ZLMediaKit快照（推荐）⭐
# - 优点：速度快（0.5s），成功率高（90%+）
# - 原理：从已有的视频流中截取一帧
# - 适用：已开启实时预览的摄像头
# 
# 方式2：ONVIF直接快照
# - 优点：独立抓图，不依赖视频流
# - 缺点：速度慢（5-10s），可能失败
# - 适用：未开启实时预览的摄像头
# 
# 系统会自动选择最佳方式（优先ZLMediaKit）
# =====================================================

# =====================================================
# ZLMediaKit 抓图配置（参考）
# =====================================================
# 
# ZLMediaKit的HTTP服务配置（config.ini）：
# 
# [http]
# # HTTP服务端口（与iot.snapshot.url-prefix的端口对应）
# port = 8080
# 
# # 静态文件根目录（包含抓图文件）
# rootPath = /snapshots
# 
# =====================================================

# =====================================================
# 关联基础设施模块的文件存储
# =====================================================
# 
# 当前实现：
# - 抓图文件直接保存到本地目录
# - 通过HTTP直接访问抓图文件
# 
# 未来扩展（可选）：
# 
# 1. 通过基础设施模块的FileService上传抓图到云存储
#    - 阿里云OSS
#    - 腾讯云COS
#    - MinIO
# 
# 2. 配置文件存储类型
# infra:
#   file:
#     type: local  # local, s3, oss, cos, minio
#     local:
#       path: /snapshots
#     oss:  # 如果使用云存储
#       endpoint: https://oss-cn-hangzhou.aliyuncs.com
#       bucket: iot-snapshots
#       accessKey: ${OSS_ACCESS_KEY}
#       secretKey: ${OSS_SECRET_KEY}
# 
# 3. 定时任务：将旧抓图上传到云存储并删除本地文件
#    - 节省本地存储空间
#    - 提供更可靠的备份
#    - 支持CDN加速访问
# 
# =====================================================

# =====================================================
# 使用说明
# =====================================================
# 
# 1. 开发环境配置（application-dev.yml）
# iot:
#   snapshot:
#     directory: D:/temp/snapshots
#     url-prefix: http://localhost:48888/snapshots
# 
# 2. 生产环境配置（application-prod.yml）
# iot:
#   snapshot:
#     directory: /data/snapshots
#     url-prefix: http://192.168.1.246:8080/snapshots
# 
# 3. 创建目录（首次使用前）
# 
# Linux:
# sudo mkdir -p /data/snapshots
# sudo chown -R app:app /data/snapshots
# 
# Windows:
# mkdir D:\data\snapshots
# 
# 4. 配置HTTP服务器（可选）
# 
# 方式1：使用Spring Boot内置的静态资源服务
# 
# spring:
#   web:
#     resources:
#       static-locations:
#         - classpath:/static/
#         - file:/data/snapshots/
# 
# 方式2：使用Nginx
# 
# location /snapshots/ {
#     alias /data/snapshots/;
#     autoindex on;
# }
# 
# 方式3：使用ZLMediaKit的HTTP服务
# 
# [http]
# port = 8080
# rootPath = /data/snapshots
# 
# =====================================================

# =====================================================
# 抓图类型说明
# =====================================================
# 
# 1. 手动抓拍（snapshotType=1）
#    - 用户点击"抓拍"按钮触发
#    - 即时生成快照
#    - 用于取证、记录重要时刻
# 
# 2. 定时抓拍（snapshotType=2）
#    - 系统按预设时间自动抓拍
#    - 例如：每小时整点抓拍
#    - 用于定期巡检、记录
# 
# 3. 报警抓拍（snapshotType=3）
#    - 系统检测到报警事件时自动抓拍
#    - 例如：入侵检测、火警等
#    - 用于报警取证、事件记录
# 
# 4. 移动侦测抓拍（snapshotType=4）
#    - 检测到画面变化时自动抓拍
#    - 用于监控区域的活动记录
#    - 可设置灵敏度和触发间隔
# 
# =====================================================

# =====================================================
# 性能优化建议
# =====================================================
# 
# 1. 使用SSD存储抓图文件
#    - 提高读写速度
#    - 减少IO等待时间
# 
# 2. 定期清理旧抓图
#    - 避免磁盘空间不足
#    - 建议保留时间：7-30天
# 
# 3. 分布式存储（大规模部署）
#    - 使用对象存储（OSS/COS/MinIO）
#    - 使用CDN加速访问
#    - 使用分布式文件系统（Ceph/GlusterFS）
# 
# 4. 图片压缩
#    - 抓图后自动压缩（可选）
#    - 平衡图片质量和存储空间
#    - 建议：JPEG质量85-90
# 
# =====================================================

